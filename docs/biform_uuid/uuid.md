# biForm 中 UUID 的使用

这篇文章将会介绍 UUID 在 biForm 中应用的场合和使用规则。

## UUID是什么

以下是百度百科中关于 UUID 的解释：

> UUID 是 通用唯一识别码（Universally Unique Identifier）的缩写，是一种软件建构的标准，亦为开放软件基金会组织在分布式计算环境领域的一部分。其目的，是让分布式系统中的所有元素，都能有唯一的辨识信息，而不需要通过中央控制端来做辨识信息的指定。如此一来，每个人都可以创建不与其它人冲突的UUID。在这样的情况下，就不需考虑数据库创建时的名称重复问题。目前最广泛应用的UUID，是微软公司的全局唯一标识符（GUID），而其他重要的应用，则有Linux ext2/ext3文件系统、LUKS加密分区、GNOME、KDE、Mac OS X等等。另外我们也可以在e2fsprogs包中的UUID库找到实现。

UUID有不同的版本，在 biForm 中的UUID是通过 Qt 的 QUuid::createUuid() 生成的UUID，格式为38位数字和字母组成的字符串，格式为”{xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx}“，比如”{402d17b4-d1d1-4ddb-b12d-da8e262536e5}“。

## biForm 在哪些地方用到了 UUID

biForm 很多场合都用到了UUID，以下几种是开发者在开发过程中经常会遇到的， 这些在开发和调试过程中都很重要，所以有必要了解一下它们应用的场合及使用规则。

### 1. 表单的属性“UUID(全程唯一标识)”

表单的UUID用于唯一地标识一个PFF表单。

biForm 用于开发PFF表单，而PFF在运行时环境下，可以任意组合，因此每个表单都需要有一个唯一的标识以便也其它表单加以区分。如果在 biReader 中打开两个PFF文件中表单的UUID值是一样的，biReader会认为它们是同一个表单，会使用后打开的文件取代前一个文件。

在 biForm 中表单的UUID是自动生成的，并且不允许修改。但直接修改BIF文件是可以修改这个值的。开发者通常不会主动去修改BIF文件。但如果开发者习惯了其它IDE的开发方式，可能会将BIF文件复制一份后再用 biForm 以此为基础修改出一个新的表单，以便复用原来表单的一些界面设计或脚本。但这样的操作，就会造成两个BIF文件的表单UUID值的重复。所以，请注意不要在这种情况下进行这样的操作，可以在 biForm 中将一个表单进行”另存为“的操作，并在另存时的弹出对话框中选择”使用新的UUID“的选项进行复制，就可以避免表单UUID冲突的问题。

这一点需要开发者特别注意。

以便运行时引擎底层，以及开发者通过脚本加以调用。

比如要在程序中打开一个表单，可以通过以下语句：

``` python

	pub.openPFF('{402d17b4-d1d1-4ddb-b12d-da8e262536e5}')

```

pub内置对象的openPFF用于按UUID打开对应的表单。如何显示由运行时环境进行处理， 在 biReader 中通常是以多文档窗口的子窗口方式加载。

还可以以弹出对话框的方式打开一个表单，如：

``` python

	pub.popupPFF('{402d17b4-d1d1-4ddb-b12d-da8e262536e5}')

```

openPFF 和 popupPFF 都可以传参数给准备打开的表单，比如：

``` python

	pub.openPFF('{402d17b4-d1d1-4ddb-b12d-da8e262536e5}',[['ID',16],['name','张三三']])

```

就是将键值对以 [['ID',16],['name','张三三']] 这种列表的格式传给准备打开的表单。在打开的表单中，可以通过 this.form.getArg 来读取这些参数的值并做相应的处理。比如： 

``` python

	ID=this.form.getArg('ID')
	name=this.form.getArg('name')

```

### 2. 表单的属性“用于打印的表单UUID”

PFF表单都可以直接按界面显示的样式打印，但在很多应用中需要打印格式化的单据、报表等，比如打印记账凭证、报销单据、财务报表等。而且打印的样式与当前正在使用的程序界面有很大不同，因此，需要单独设计一个表单，专用于打印，这个表单的样式按照打印时的样式进行设计。在调用打印过程的表单中，设置“用于打印的表单UUID”就可以在运行时调用这个表单进行格式化打印。

也可以在 python 脚本中修改这个属性的值，如：

``` python

	this.form.setPrintFormUUID('{402d17b4-d1d1-4ddb-b12d-da8e262536e5}')

```

与之配套使用的还有表单的”打印参数“脚本，通过这段脚本返回的值会做为参数传递给打印用的表单，类似于调用 pub.openPFF 传入的参数。

### 3. 数据表的属性“UUID(全程唯一标识)”

表单若需要使用数据库中的表，需要为每个表设置UUID。biForm中设计数据表时的”表名“在创建数据表的实体对象时，是动态生成表名的。真正用于区分不同的表是用的UUID。

在biForm中会自动为新建的数据表生成UUID，并允许修改。虽然允许修改，但不建议随意进行修改。

数据表的UUID在PFF的运行时是非常重要的，虽然通常不会需要在 python 脚本中直接使用。

数据表的UUID在运行时会遵循以下规则：

- 在底层数据库引擎中通过UUID来确定每个数据表对应的实体表，而不是通过表名

- 不同表单上相同UUID的数据表，会被指向同一个实体表，从而不同的表单可以共享数据

- 如果UUID不同，即使表名相同，也会被认为是两个表

- 如果UUID相同，即使表名不同，也会被认为是同一个表，但如果是后创建的表与前面的表结构不同，会创建失败

在 python 脚本中如果需要取得实体表的表名，比如用于拼接SQL语句，需要使用 getRealTableName(表名)，不需要使用表的UUID，所以在同一个表单的数据视图中有多个数据表，表名是不允许重复的。

以下是一个调用的示例：

``` python

	db=this.form.database()
	result = db.execute("select * from "+db.getRealTableName('mytable')+\
		" where fcount>100")
	print(result)

```






